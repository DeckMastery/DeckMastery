// DeckMastery i18n (LocalStorage: dm_lang = 'ar'|'en')
export function getLang(){
  return localStorage.getItem("dm_lang") || "ar";
}

export function setLang(lang){
  localStorage.setItem("dm_lang", (lang === "en") ? "en" : "ar");
}

export function applyLang(){
  const lang = getLang();
  const root = document.documentElement;
  root.lang = (lang === "en") ? "en" : "ar";
  root.dir = (lang === "en") ? "ltr" : "rtl";
  if(document.body) document.body.classList.toggle("lang-en", lang === "en");
}

const MAP = {
  "آخر": "Other",
  "أدخل اسم مستخدم واختر الجنس، ثم ابدأ.": "Enter a username, choose gender, then start.",
  "أستاذ": "Master",
  "أفاتار الآخر": "Other Avatar",
  "أفاتار الأنثى": "Female Avatar",
  "أفاتار الذكر": "Male Avatar",
  "أكمل الدرس حتى «التقييم» لتسجيل الحضور. الخروج قبل التقييم يلغي الجوائز ولا يسجّل حضورًا.": "Finish the lesson up to “Rating” to record attendance. Leaving before rating cancels rewards and does not count attendance.",
  "ألماسي": "Diamond",
  "أنثى": "Female",
  "إجراءات": "Actions",
  "إجراءات (0)": "Actions (0)",
  "إزالة من الرزمة": "Remove from pack",
  "إضافة": "Add",
  "إضافة إلى رزمة": "Add to pack",
  "إضافة بطاقة": "Add card",
  "إضافة بطاقة أخرى": "Add another card",
  "الأصدقاء": "Friends",
  "الأفاتارات": "Avatars",
  "الإطار الخشبي الدائري": "Wooden round frame",
  "الإطارات": "Frames",
  "الإعدادات": "Settings",
  "الاسم": "Name",
  "الاسم المستعار": "Username",
  "الالتزام": "Streak",
  "البدء": "Start",
  "التجاهل": "Ignored",
  "التحديد": "Select",
  "التخصيص": "Customize",
  "الترجمة أو التوضيح": "Translation / explanation",
  "التصنيف": "Leaderboard",
  "التعليمات": "Help",
  "التقييم": "Rating",
  "التلميح": "Hint",
  "التنبيهات": "Notifications",
  "الإشعارات": "Notifications",
  "التوصيل": "Matching",
  "الجنس": "Gender",
  "الجوائز": "Rewards",
  "الحد الأدنى 4.": "Minimum is 4.",
  "الحساب": "Account",
  "الحماس": "Streak",
  "الخلفيات": "Backgrounds",
  "الدرس اليومي": "Daily lesson",
  "الدعم": "Support",
  "الدقة": "Accuracy",
  "الذهب": "Gold",
  "الرئيسية": "Home",
  "الصوت": "Audio",
  "العودة بعد الغياب": "Return after absence",
  "الكتابة": "Typing",
  "اللعب": "Play",
  "اللعبة التالية": "Next game",
  "المتجر": "Shop",
  "المجموعات اليومية": "Daily groups",
  "المشاركة": "Share",
  "المعنى": "Meaning",
  "المكتملة": "Completed",
  "الملف الشخصي": "Profile",
  "المهمات": "Quests",
  "النبذة": "Bio",
  "النجوم": "Stars",
  "النسخ الاحتياطي": "Backup",
  "النص": "Text",
  "النص الأصلي": "Original text",
  "اليوم الثاني": "Day 2",
  "انتبه! بعد الحذف لن تتمكن من استعادة بياناتك.": "Warning! After deletion, you can’t restore your data.",
  "بحث": "Search",
  "بحث بالتاريخ": "Search by date",
  "بدء": "Start",
  "بداية موسم جديد": "New season",
  "بطاقة إضافية": "Extra card",
  "بلاتيني": "Platinum",
  "تأكيد": "Confirm",
  "تأكيد التخطي؟": "Confirm skip?",
  "تأكيد نهائي": "Final confirmation",
  "تجاهل": "Ignore",
  "تحديد": "Select",
  "تحديد الكل": "Select all",
  "إلغاء التحديد": "Unselect",
  "تحذير": "Warning",
  "تحكم بالصوت. استخدم «تصدير بياناتي» و«استيراد بياناتي» للحفظ الاحتياطي.": "Control audio. Use “Export my data” and “Import my data” for backups.",
  "تخطي": "Skip",
  "تخطي لعبة": "Skip game",
  "تدريب": "Training",
  "تدريب سريع بدون تقييم. لا يسجّل حضورًا ولا يغيّر مستويات البطاقات.": "Quick training without rating. It does not record attendance and does not change card levels.",
  "تراجع": "Undo",
  "ترتيب الأحرف": "Anagram",
  "ترقية مستوى": "Level up",
  "تسجيل الخروج": "Log out",
  "تصدير بياناتي": "Export my data",
  "تصنيف محلي على هذا الجهاز. الموسم يُعاد ضبطه كل 100 يوم وفق خوارزمية التصفير.": "Local leaderboard on this device. The season resets every 100 days using the reset algorithm.",
  "تعديل": "Edit",
  "تعذّر قراءة الملف.": "Could not read the file.",
  "تعذّر قراءة بيانات المشاركة.": "Could not read share data.",
  "تعذّر قراءة رابط المشاركة.": "Could not read share link.",
  "تفاصيل": "Details",
  "تم": "Done",
  "تم استخدام مساعدة.": "A help item was used.",
  "تم بلوغ الحد اليومي.": "Daily limit reached.",
  "تم بلوغ الحد.": "Limit reached.",
  "تم تسجيل الحضور": "Attendance recorded",
  "تم تصفير الموسم.": "Season reset.",
  "تم تنزيل ملف المشاركة": "Share file downloaded",
  "تم تنزيل ملف المشاركة على جهازك.": "The share file was downloaded to your device.",
  "تم.": "Done.",
  "تنبيه": "Notice",
  "تنبيه مساحة التخزين": "Storage reminder",
  "تنزيل الآن": "Download now",
  "توصيل": "Connect",
  "تُعلَّم التنبيهات كمقروءة عند فتح الصفحة. استلام الجوائز يتطلب النقر عليها.": "Notifications are marked as read when you open this page. Claiming rewards requires tapping them.",
  "جديد": "New",
  "جميع البطاقات": "All cards",
  "حديدي": "Iron",
  "حدّد بطاقات أولاً.": "Select cards first.",
  "حذف": "Delete",
  "حذف البيانات والخروج؟": "Delete data and exit?",
  "حذف الحساب": "Delete account",
  "حذف نهائي": "Permanent delete",
  "حذف وخروج": "Delete & exit",
  "حسنًا": "OK",
  "حفظ": "Save",
  "حقول ناقصة.": "Missing fields.",
  "حكيم": "Sage",
  "خشبي": "Wood",
  "خشبي 1": "Wood 1",
  "خطأ": "Wrong",
  "خلفية الآخر": "Other background",
  "خلفية الأنثى": "Female background",
  "خلفية الذكر": "Male background",
  "ذكر": "Male",
  "ذهبي": "Gold",
  "رجوع": "Back",
  "رزم البطاقات": "Card packs",
  "رصيد غير كافٍ.": "Insufficient balance.",
  "زمردي": "Emerald",
  "سجل المساعدات": "Help log",
  "سلم التصنيفات": "Rank ladder",
  "سهل": "Easy",
  "سيتم إضافة المهمات قريبًا.": "Quests will be added soon.",
  "سيتم إنشاء طريق الإتقان قريبًا.": "Mastery Path will be created soon.",
  "سيتم توفير هذه الميزة قريبًا.": "This feature will be available soon.",
  "شارك هذا الملف مع الشخص الآخر (عبر واتساب أو تلغرام أو البريد الإلكتروني).": "Share this file with the other person (WhatsApp, Telegram, or email).",
  "شراء": "Buy",
  "صعب": "Hard",
  "طريق الإتقان": "Mastery Path",
  "عودة": "Return",
  "غيّر الأفاتار/الخلفية/الإطار من قسم التخصيص. العناصر المملوكة تظهر ويمكن تفعيلها بزر «استخدام».": "Change your avatar/background/frame from Customize. Owned items appear and can be applied with “Use”.",
  "فتح": "Open",
  "فضي": "Silver",
  "قلب البطاقات": "Flip cards",
  "قفل": "Locked",
  "كلمة السر": "Password",
  "لا توجد تعليمات لهذه الصفحة.": "No help is available for this page.",
  "لا يوجد بطاقات كافية.": "Not enough cards.",
  "لا يمكن إضافة بطاقة خارج مجموعة يومية.": "You can’t add a card outside a daily group.",
  "لا يمكن ترك الحقول فارغة.": "Fields cannot be empty.",
  "لا": "No",
  "لديك نسخة احتياطية قديمة:": "You have an old backup:",
  "لعبة": "Game",
  "مشاركة": "Share",
  "متوسط": "Medium",
  "متابعة": "Continue",
  "متابعة الكل": "Continue all",
  "مرحبًا": "Welcome",
  "مسح": "Clear",
  "مساعدة": "Help",
  "مستوى صوت التفاعلات": "SFX volume",
  "مستوى صوت الموسيقى": "Music volume",
  "ملف غير صالح": "Invalid file",
  "ملف غير صالح.": "Invalid file.",
  "ملهم": "Inspirer",
  "ممتلك": "Owned",
  "موافق": "OK",
  "نحاسي": "Bronze",
  "نسخة احتياطية أسبوعية": "Weekly backup",
  "هذا ليس ملف مشاركة DeckMastery.": "This is not a DeckMastery share file.",
  "هل أنت متأكد؟": "Are you sure?",
  "هل تود الاستمرار؟": "Do you want to continue?",
  "وعلى الطرف الآخر اختيار «استيراد ملف مشاركة» من الإعدادات لاستقبال البطاقات.": "On the other side, choose “Import share file” from Settings to receive the cards.",
  "وقود": "Fuel",
  "يتتبع الالتزام اليومي. يمكن وصل أيام الانقطاع باستخدام الوقود.": "Tracks daily streak. You can reconnect missed days using Fuel.",
  "نصيحة مهمة: قبل أن تضع وقتك في التطبيق، صدِّر بياناتك من «الإعدادات» عبر «تصدير بياناتي»، واحتفظ بملف النسخ الاحتياطي لتستطيع استيراده لاحقًا عند تغيير الجهاز أو حذف بيانات المتصفح.\n\nآلية البطاقات: أي بطاقة تُضيفها اليوم تُحفظ ضمن مجموعة تاريخ اليوم، وتبدأ بالظهور في الألعاب ابتداءً من الغد ثم وفق جدول المستويات المتفق عليه.\n\nلديك اقتراح أو ملاحظة؟ أرسلها إلى بريد الدعم الموجود داخل «الإعدادات».": "Important tip: before you invest your time, export your data from “Settings” using “Export my data”, and keep the backup file so you can import it later if you change devices or clear your browser data.\n\nHow cards work: any card you add today is saved inside today’s daily group, and it starts appearing in games from tomorrow, then continues according to the agreed level schedule.\n\nHave a suggestion or a note? Send it to the support email shown inside “Settings”.",
  "لم يتم تسجيل حضور اليوم.": "Today’s attendance has not been recorded.",
  "استخدام": "Use",
  "استيراد بياناتي": "Import my data",
  "استيراد ملف مشاركة": "Import share file",
  "تصدير ملف مشاركة": "Export share file",
  "تم استيراد البيانات.": "Data imported.",
  "تم تصدير البيانات.": "Data exported.",
  "اللغة": "Language",
  "العربية": "Arabic",
  "إغلاق": "Close",
  "إلغاء": "Cancel",
  "اسم غير صالح.": "Invalid username.",
  "نعم": "Yes",
  "مفكر": "Thinker",
  "بدء اللعب": "Start",
  "عشوائي": "Random",
  "إعادة": "Reset",
  "إطار": "Frame",
  "أيام": "Days",
  "استيراد": "Import",
  "تصدير": "Export",
  "خروج": "Exit",
  "تجربة": "Try",
  "سحب وإفلات ملف JSON هنا أو انقر للاختيار": "Drag & drop a JSON file here, or click to choose.",
  "ملف البيانات ليس JSON صالحاً.": "The data file is not valid JSON.",
  "ممنوع الخروج الآن.": "Exiting is disabled right now.",
  "لا يوجد بطاقات.\nأضف بطاقات من زر «إضافة بطاقة».": "No cards.\nAdd cards using “Add card”.",
  "الإنجازات": "Achievements",
  "الموسم": "Season",
  "باقي": "Remaining",
  "إستمرار": "Continue",
  "استخدام 1 وقود لتوصيل الحماسة؟": "Use 1 Fuel to reconnect the streak?",
  "أفهمت": "Got it",
  "إغلاق الصفحة": "Close page",
  "إضافة رزمة": "Add pack",
  "إنهاء التدريب": "End training",
  "إنهاء الجلسة": "End session",
  "إنهاء وحفظ": "Finish & save",
  "إلغاء وخروج": "Cancel & exit",
  "اختر 4 بطاقات على الأقل": "Select at least 4 cards",
  "اختر بطاقة واحدة على الأقل.": "Select at least one card.",
  "اختيار رزم": "Choose packs",
  "استلام": "Claim",
  "استمرار": "Continue",
  "اسم فارغ.": "Empty name.",
  "اسم مستخدم.": "Username.",
  "الأدوات التشغيلية": "Power-ups",
  "تم رصد أيام غياب.": "Missed days detected.",
  "لا توجد بطاقات كافية للتدريب.": "Not enough cards for training.",
  "لا توجد بطاقات لليوم.": "No cards for today.",
  "لا توجد رزم.": "No packs.",
  "لا توجد عناصر.": "No items.",
  "لا يوجد.": "None.",
  "لاحقًا": "Later",
  "لعب": "Play",
  "محدد": "Selected",
  "مساعدة مستخدمة.": "Help used.",
  "مستخدم": "User",
  "مقروء": "Read",
  "اكتب الكلمة الأجنبية في الحقل الأول، وترجمتها في الثاني، وتلميحًا في الثالث. الحد الأدنى 4 بطاقات والحد الأقصى 8. يمكنك شراء بطاقتين إضافيتين من المتجر.": "Put the foreign word in the first field, its meaning in the second, and a hint in the third. Minimum 4 cards, maximum 8. You can buy 2 extra cards from the shop.",
  "افتح أي رزمة ثم استخدم «تحديد» لتنفيذ الإجراءات على عدة بطاقات. «تدريب» يتطلب 4 بطاقات فأكثر.": "Open any pack, then use “Select” to run actions on multiple cards. “Training” requires at least 4 cards.",
  "اشترِ الأدوات والتخصيص. العناصر المشتراة تختفي من المتجر وتظهر ضمن مكتبة الملف الشخصي.": "Buy power-ups and cosmetics. Purchased items disappear from the shop and appear in your Profile library."
};

const RANK_NAME_MAP = {
  "خشبي":"Wood",
  "حديدي":"Iron",
  "نحاسي":"Bronze",
  "فضي":"Silver",
  "ذهبي":"Gold",
  "زمردي":"Emerald",
  "بلاتيني":"Platinum",
  "ألماسي":"Diamond",
  "أستاذ":"Master",
  "مفكر":"Thinker",
  "حكيم":"Sage",
  "ملهم":"Inspirer"
};

export function tr(text){
  if(typeof text !== "string") return text;
  if(getLang() !== "en") return text;

  if(MAP[text]) return MAP[text];

  const m = text.match(/^([\u0600-\u06FF]+)\s(\d+)$/);
  if(m){
    const name = m[1];
    const num = m[2];
    if(RANK_NAME_MAP[name]) return `${RANK_NAME_MAP[name]} ${num}`;
  }

  const m2 = text.match(/^المستوى\s(\d+)$/);
  if(m2) return `Level ${m2[1]}`;

  const m3 = text.match(/^الذهب\s(\d+)$/);
  if(m3) return `Gold ${m3[1]}`;

  const m4 = text.match(/^البطاقة\s(\d+)\sمن\s(\d+)$/);
  if(m4) return `Card ${m4[1]} of ${m4[2]}`;

  const m5 = text.match(/^بقي\s(\d+)\sيومًا\sعلى\sنهاية\sالموسم$/);
  if(m5) return `${m5[1]} days left in the season`;

  return text;
}
